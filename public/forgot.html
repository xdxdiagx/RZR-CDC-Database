<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Cuba admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords"
        content="admin template, Cuba admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="assets/images/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon">
    <title>ZumeCall</title>
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i&amp;display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap"
        rel="stylesheet">
    <!-- Font Awesome-->
    <link rel="stylesheet" type="text/css" href="assets/css/fontawesome.css">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="assets/css/icofont.css">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="assets/css/themify.css">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="assets/css/flag-icon.css">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="assets/css/feather-icon.css">
    <!-- Plugins css start-->
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="assets/css/style-forgot.css">
    <link id="color" rel="stylesheet" href="assets/css/color-1.css" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="assets/css/responsive.css">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2.3.2/dist/email.min.js"></script>
    <script type="text/javascript">
        (function () {
            emailjs.init("user_W6eirxGmsvTpc0TFJg2LI");
        })();
    </script>
</head>

<body>
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper">
        <div class="container-fluid p-0">
            <!-- login page with video background start-->
            <div class="auth-bg-video">
                <video id="bgvid" poster="assets/images/other-images/coming-soon-bg.jpg" playsinline="" autoplay=""
                    muted="" loop="">
                    <source src="assets/video/auth-bg.mp4" type="video/mp4">
                </video>
                <div class="authentication-box">
                    <div class="mt-4">
                        <div class="card-body">
                            <div class="cont text-left">
                                <div>
                                    <form class="theme-form">
                                        <div class="text-danger wrapper text-center" id="messages4"></div>
                                        <div class="text-success wrapper text-center" id="success4"></div>
                                        <br>
                                        <h4>Reset</h4>
                                        <h6>Change your password here</h6>
                                        <div class="form-group">
                                            <label class="col-form-label pt-0">Requested password</label>
                                            <input class="form-control" type="email" id="reqPassword" required="">
                                        </div>
                                        <div class="form-group">
                                            <label class="col-form-label">New Password</label>
                                            <input class="form-control" type="password" id="newPassword" required="">
                                        </div>
                                        <div class="form-group">
                                            <label class="col-form-label">Confirm Password</label>
                                            <input class="form-control" type="password" id="confirmPassword"
                                                required="">
                                        </div>
                                        <!-- <div class="checkbox p-0">
                                            <input id="checkbox1" type="checkbox">
                                            <label for="checkbox1">Remember me</label>
                                        </div> -->
                                        <div class="form-group ">
                                            <button class="btn btn-primary btn-block" type="button"
                                                onclick="changePass()">Change</button>
                                        </div>

                                        <div>
                                            <!-- <p class="mb-1"> -->
                                            <!-- <a href="#" id="btnToForgot" data-toggle="modal"
                                                data-target="#myModal">Forgot Password</a> -->
                                            <!-- </p> -->
                                            <!-- <label>Forgot Password</label> -->
                                        </div>
                                        <div class="login-divider"></div>
                                        <!-- <div class="social mt-3">
                                            <div class="row btn-showcase">
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-fb">Facebook</button>
                                                </div>
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-twitter">Twitter</button>
                                                </div>
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-google">Google + </button>
                                                </div>
                                            </div>
                                        </div> -->
                                    </form>
                                </div>
                                <div class="sub-cont">
                                    <div class="img">
                                        <div class="img__text m--up">
                                            <h2>One of us?</h2>
                                            <p>If you already has an account, just sign in. We've missed you!</p>
                                        </div>
                                        <div class="img__text m--in">
                                            <h2>You forgot your password?</h2>
                                            <p>Here you can easily retrieve a new password.</p>
                                        </div>
                                        <div class="img__btn"><span class="m--up">Login</span><span
                                                class="m--in">Reset</span></div>
                                    </div>
                                    <form class="theme-form">
                                        <h4>LOGIN</h4>
                                        <h6>Enter your Username and Password</h6>
                                        <div class="form-group">
                                            <label class="col-form-label pt-0">Email</label>
                                            <input class="form-control" type="email" id="loginEmail" required="">
                                        </div>
                                        <div class="form-group">
                                            <label class="col-form-label">Password</label>
                                            <input class="form-control" type="password" id="loginPassword" required="">
                                        </div>
                                        <div class="checkbox p-0">
                                            <input id="checkbox1" type="checkbox">
                                            <label for="checkbox1">Remember me</label>
                                        </div>
                                        <div class="form-group ">
                                            <button class="btn btn-success btn-block" type="button"
                                                id="signIn">LOGIN</button>
                                        </div>

                                        <div>
                                            <!-- <p class="mb-1"> -->
                                            <a href="#" id="btnToForgot" data-toggle="modal"
                                                data-target="#myModal">Forgot Password</a>
                                            <!-- </p> -->
                                            <!-- <label>Forgot Password</label> -->
                                        </div>
                                        <div class="login-divider"></div>
                                        <div class="social mt-3">
                                            <div class="row btn-showcase">
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-fb">Facebook</button>
                                                </div>
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-twitter">Twitter</button>
                                                </div>
                                                <div class="col-md-4 col-sm-6">
                                                    <button class="btn social-btn btn-google">Google + </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal -->
                <div class="modal fade" id="myModal" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Forgot Password</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form action="" method="post">
                                    <div class="input-group mb-3">
                                        <input type="email" class="form-control" id="forgotEmail" placeholder="Email">
                                        <div class="input-group-append">
                                            <!-- <div class="input-group-text">
                                                <span class="fas fa-envelope"></span>
                                            </div> -->
                                        </div>
                                    </div>
                                    <!-- <div class="row">
                                        <div class="col-12">
                                            <button type="button" class="btn btn-primary btn-block" onclick="resetPassword()">Request new password</button>
                                        </div>
                     
                                    </div> -->
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal"
                                    onclick="resetPassword()">Send</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- login page with video background end-->
        </div>
    </div>
    <!-- latest jquery-->
    <script src="assets/js/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap js-->
    <script src="assets/js/bootstrap/popper.min.js"></script>
    <script src="assets/js/bootstrap/bootstrap.js"></script>
    <!-- feather icon js-->
    <script src="assets/js/icons/feather-icon/feather.min.js"></script>
    <script src="assets/js/icons/feather-icon/feather-icon.js"></script>
    <!-- Sidebar jquery-->
    <script src="assets/js/sidebar-menu.js"></script>
    <script src="assets/js/config.js"></script>
    <!-- Plugins JS start-->
    <script src="assets/js/form-wizard/form-wizard-five.js"></script>
    <script src="assets/js/tooltip-init.js"></script>
    <script src="assets/js/login.js"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="assets/js/script.js"></script>
    <!-- login js-->
    <!-- Plugin used-->


    <script>
        $('#btnToRegister').click(function () {
            $('#loginStyle').hide();
            $('#forgotStyle').hide();
            $('#registerStyle').show();
            // console.log('To Register');
        });
        var Base64 = {


            _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",


            encode: function (pwd) {
                var output = "";
                var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
                var i = 0;

                pwd = Base64._utf8_encode(pwd);

                while (i < pwd.length) {

                    chr1 = pwd.charCodeAt(i++);
                    chr2 = pwd.charCodeAt(i++);
                    chr3 = pwd.charCodeAt(i++);

                    enc1 = chr1 >> 2;
                    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                    enc4 = chr3 & 63;

                    if (isNaN(chr2)) {
                        enc3 = enc4 = 64;
                    } else if (isNaN(chr3)) {
                        enc4 = 64;
                    }

                    output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr
                        .charAt(enc3) + this._keyStr.charAt(enc4);

                }

                return output;
            },


            decode: function (pwd) {
                var output = "";
                var chr1, chr2, chr3;
                var enc1, enc2, enc3, enc4;
                var i = 0;

                pwd = pwd.replace(/[^A-Za-z0-9\+\/\=]/g, "");

                while (i < pwd.length) {

                    enc1 = this._keyStr.indexOf(pwd.charAt(i++));
                    enc2 = this._keyStr.indexOf(pwd.charAt(i++));
                    enc3 = this._keyStr.indexOf(pwd.charAt(i++));
                    enc4 = this._keyStr.indexOf(pwd.charAt(i++));

                    chr1 = (enc1 << 2) | (enc2 >> 4);
                    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                    chr3 = ((enc3 & 3) << 6) | enc4;

                    output = output + String.fromCharCode(chr1);

                    if (enc3 != 64) {
                        output = output + String.fromCharCode(chr2);
                    }
                    if (enc4 != 64) {
                        output = output + String.fromCharCode(chr3);
                    }

                }

                output = Base64._utf8_decode(output);

                return output;

            },

            _utf8_encode: function (string) {
                string = string.replace(/\r\n/g, "\n");
                var utftext = "";

                for (var n = 0; n < string.length; n++) {

                    var c = string.charCodeAt(n);

                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    } else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    } else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }

                }

                return utftext;
            },

            _utf8_decode: function (utftext) {
                var string = "";
                var i = 0;
                var c = c1 = c2 = 0;

                while (i < utftext.length) {

                    c = utftext.charCodeAt(i);

                    if (c < 128) {
                        string += String.fromCharCode(c);
                        i++;
                    } else if ((c > 191) && (c < 224)) {
                        c2 = utftext.charCodeAt(i + 1);
                        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                        i += 2;
                    } else {
                        c2 = utftext.charCodeAt(i + 1);
                        c3 = utftext.charCodeAt(i + 2);
                        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                        i += 3;
                    }

                }

                return string;
            }

        }

        var encode = document.getElementById('encode'),
            decode = document.getElementById('decode'),
            save = document.getElementById('save'),
            signIn = document.getElementById('signIn'),
            output = document.getElementById('output'),
            pwd = document.getElementById('password');

        // encode.onclick = function() {
        // output.innerHTML = Base64.encode(pwd.value);
        // }

        // decode.onclick = function() {
        // var $str = output.innerHTML;
        // output.innerHTML = Base64.decode($str);
        // }

        // save.onclick = function () {
        //     ajaxsave()
        // }

        signIn.onclick = function () {
            login()
        }

        $('#comLogo').on("change", function () {
            // console.log(document.getElementById("comLogo").files[0].name);
            $("#comLogoLabel").text(document.getElementById("comLogo").files[0].name);
        });

        $('#picture').on("change", function () {
            // console.log(document.getElementById("picture").files[0].name);
            $("#pictureLabel").text(document.getElementById("picture").files[0].name);
        });

        function ajaxsave() {

            var logo, picture;

            fileSelect = document.getElementById("comLogo").files;
            fileSelect2 = document.getElementById("picture").files;
            if (fileSelect.length > 0) {
                var fileSelect = fileSelect[0];
                var fileReader = new FileReader();

                fileReader.onload = function (FileLoadEvent) {
                    var data = FileLoadEvent.target.result;
                    logo = data;
                    // console.log(data);
                    localStorage.setItem("logo", data);

                }
                fileReader.readAsDataURL(fileSelect);
            }

            if (fileSelect2.length > 0) {
                var fileSelect2 = fileSelect2[0];
                var fileReader2 = new FileReader();

                fileReader2.onload = function (FileLoadEvent) {
                    var data2 = FileLoadEvent.target.result;
                    picture = data2;
                    // console.log(data2);
                    localStorage.setItem("picture", data2);

                }
                fileReader2.readAsDataURL(fileSelect2);
            }

            // var logo = document.getElementById("comLogo");
            // logo.addEventListener("change", function () {
            //     encodeImageFileURL();
            // })



            var myData = JSON.stringify({

                //     // "count": "13",
                //     // "domain": "www.done.com"
                "name": $('#comName').val(),
                "address": $('#comAdd').val(),
                "contact": $('#comNum').val(),
                "logo": localStorage.getItem("logo"),
                "subscription": "0",
                // "password": Base64.encode(pwd.value),
                // "role": ""

            });
            // console.log(myData);
            $.ajax({
                type: "POST",
                dataType: "json",
                // url: "https://pq38i6wtd4.execute-api.ap-southeast-1.amazonaws.com/verkoapi/adcounts/{domain}",
                url: "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/companies/{id}",
                data: myData,
                headers: {
                    "Content-Type": "application/json"
                },
                success: function (response) {
                    console.log(response);
                    console.log("Success");
                    // sessionStorage.setItem("state", 1);
                    // document.getElementById("success2").innerHTML = "Success, Redirecting to login. . .";
                    // setTimeout(function(){ 
                    // $('#registerStyle').hide();
                    // $('#forgotStyle').hide();
                    // $('#loginStyle').show();
                    // },3000);

                    // window.location.href = './index.html';
                },
                error: function (response) {
                    console.log(response.responseText);

                    var id = response.responseText;
                    // localStorage.setItem("comid", id);

                    var str = id;
                    var res = str.split("\r\n", 1);

                    console.log(res[0]);

                    var myData2 = JSON.stringify({

                        //     // "count": "13",
                        //     // "domain": "www.done.com"
                        "email": $('#email').val(),
                        "comid": res[0],
                        // "comid": $('#email').val(),
                        "contact": $('#contact').val(),
                        "designation": $('#designation').val(),
                        "fullname": $('#fullname').val(),
                        "image": localStorage.getItem("picture"),
                        "password": Base64.encode(pwd.value),
                        "role": "1",

                        // "password": Base64.encode(pwd.value),
                        // "role": ""

                    });

                    console.log(myData2);

                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        // url: "https://pq38i6wtd4.execute-api.ap-southeast-1.amazonaws.com/verkoapi/adcounts/{domain}",
                        url: "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/users/{email}",
                        data: myData2,
                        headers: {
                            "Content-Type": "application/json"
                        },
                        success: function (data) {
                            console.log(data);
                            // console.log("Success");
                            sessionStorage.setItem("state", 1);
                            // document.getElementById("success2").innerHTML = "Success, Redirecting to login. . .";
                            // setTimeout(function(){ 
                            // $('#registerStyle').hide();
                            // $('#forgotStyle').hide();
                            // $('#loginStyle').show();
                            // },3000);

                            window.location.href = './index.html';
                        },
                        error: function (response) {
                            console.log(response);
                            console.log("Error");

                        }
                    });
                }
            });

        }


        function login() {

            const username = $('#loginEmail').val();

            var settings = {
                "url": "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/users/" + username,
                "method": "GET",
                "timeout": 0,
            };
            $.ajax(settings).done(function (response) {
                var user = response.username;
                console.log(response);
                console.log(response.email);
                if (response.email && response.password) {
                    console.log(Base64.decode(response.password));
                    // var lsrole = 0;
                    var decodedPwd = Base64.decode(response.password);
                    // var role = response.role;
                    var signInPwd = $('#loginPassword').val();
                    // console.log(role);
                    // if (role == "ordinary") {
                    //     lsrole = 1;
                    // } else if (role == "admin") {
                    //     lsrole = 2;
                    // }
                    if (signInPwd == decodedPwd) {
                        sessionStorage.setItem("state", 1);
                        sessionStorage.setItem("user", user);
                        // sessionStorage.setItem("role", lsrole);
                        console.log("You're in!");
                        window.location.href = './index.html';

                    } else {
                        // document.getElementById("messages").innerHTML = "Your password is incorrect!";
                        console.log("Your password is incorrect!");
                    }
                }
                // else if (response.username && response.password && !response.role) {
                //     document.getElementById("messages").innerHTML =
                //         "Kindly contact the administrator for your authorization";
                // } 
                else if (!response.email && !response.password) {
                    // document.getElementById("messages").innerHTML = "Your account is not registered";
                    console.log("Your account is not registered");
                }

            });
        }

        function register() {
            var username = $('#username').val()
            var email = $('#email').val()
            var password = $('#password').val()

            localStorage.setItem("username", username);
            localStorage.setItem("register", "custom");



            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then(function (user) {
                    console.log(user.uid);
                    $('#registerStyle').hide();
                    $('#forgotStyle').hide();
                    $('#loginStyle').show();
                    document.getElementById("username").innerHTML = " ";
                    document.getElementById("email").innerHTML = " ";
                    document.getElementById("password").innerHTML = " ";
                    window.location.href = './index.html';
                    // username = "";
                    // email = "";
                    // password = "";
                }).catch(function (error) {
                    console.log(error.code);
                    console.log(error.message);
                    document.getElementById("messages2").innerHTML = error.message;
                });
        }







        function resetPassword() {
            var email = $('#forgotEmail').val()
            // console.log(email);
            if (email) {
                let r = Math.random().toString(30).substring(5);
                // console.log("random", r);

                localStorage.setItem("req", r);
                localStorage.setItem("user", email);

                var template_params = {
                    "reply_to": email,
                    "from_name": "FVS Team",
                    "to_name": "",
                    "message_html": r
                }


                var service_id = "fvs";
                var template_id = "template_10sru4c";
                emailjs.send(service_id, template_id, template_params);

                console.log("Sent");

                // document.getElementById("messages3").innerHTML =
                //     "A reset password sent to your email address. It will expire after 2 hours.";

                // setTimeout(function () {
                //     $('#forgotStyle').hide();
                //     $('#changePass').show();
                // }, 7000);
            } else {
                document.getElementById("messages3").innerHTML = "Enter your email address in order to request!";
            }

        }

        function changePass() {
            var req = $('#reqPassword').val();
            var newPass = $('#newPassword').val();
            var confirmPass = $('#confirmPassword').val();
            var user = localStorage.getItem('user');
            var lsrole;
            if (localStorage.getItem('req') == req) {
                if (newPass == confirmPass) {
                    // console.log("Success!");
                    document.getElementById("success4").innerHTML = "Success!";
                    var settings = {
                        "url": "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/users/" + user,
                        "method": "GET",
                        "timeout": 0,
                    };
                    $.ajax(settings).done(function (response) {
                        // console.log(response);
                        if (response.role == 0) {
                            lsrole = 0;
                            console.log("0");
                        } else if (response.role == 1) {
                            lsrole = 1;
                            console.log("1");
                        } else if (response.role == 2) {
                            lsrole = 2;
                            console.log("2");
                        }

                        if (response.email && response.password) {

                            var myData = JSON.stringify({

                                "email": user,
                                "comid": response.comid,
                                "contact": response.contact,
                                "designation": response.designation,
                                "fullname": response.fullname,
                                "image": response.image,
                                "password": Base64.encode(newPass),
                                "role": response.role,
                                "verification": response.verification

                            });
                            console.log(myData);
                            $.ajax({
                                type: "POST",
                                dataType: "json",
                                // url: "https://pq38i6wtd4.execute-api.ap-southeast-1.amazonaws.com/verkoapi/adcounts/{domain}",
                                url: "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/users/{email}",
                                data: myData,
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                success: function (data) {
                                    console.log("Success");
                                    sessionStorage.setItem("state", 1);
                                    sessionStorage.setItem("role", lsrole);
                                    // $('#registerStyle').hide();
                                    // $('#forgotStyle').hide();
                                    // $('#loginStyle').show();
                                    window.location.href = './index.html';
                                },
                                error: function (error) {
                                    console.log(error);
                                }
                            });

                        }


                    });
                } else {
                    document.getElementById("messages4").innerHTML = "Your password doesn't match";
                }
            } else {
                document.getElementById("messages4").innerHTML = "Your requested password doesn't match";
            }


        }
    </script>

</body>

</html>